<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scratchlet - Settings</title>
<link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Nunito',sans-serif; }
  :root{
    --primary: #FF8C00;
    --secondary: #FFA500;
    --text: #fff;
  }

  body{
    background:
      linear-gradient(rgba(255,140,0,0.15) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,165,0,0.15) 1px, transparent 1px),
      linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    background-size: 40px 40px;
    min-height: 100vh;
    padding: 20px;
    color: var(--text);
    transition: background .5s ease, color .35s;
  }

  /* Header */
  .header{
    display:flex; justify-content:space-between; align-items:center;
    padding:20px; background: rgba(255,255,255,0.1);
    border-radius:15px; border:2px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(8px); margin-bottom:30px;
  }
  .logo-text { font-family:"Titan One",sans-serif; font-size:2.5em; color:#fff; text-shadow:2px 2px 4px rgba(0,0,0,0.3); }
  .nav-buttons { display:flex; gap:12px; flex-wrap:wrap; }
  .nav-btn{ background:rgba(255,255,255,0.9); color:var(--primary); padding:10px 20px; border-radius:20px; text-decoration:none; font-weight:600; box-shadow:0 4px 12px rgba(0,0,0,0.2); transition: all .25s ease; }
  .nav-btn:hover { transform:translateY(-2px) scale(1.05); box-shadow:0 6px 18px rgba(0,0,0,0.25); }

  /* Container */
  .settings-container{
    max-width:880px; margin:auto;
    background:rgba(255,255,255,0.12);
    padding:28px; border-radius:18px;
    border:2px solid rgba(255,255,255,0.14);
    box-shadow:0 14px 40px rgba(0,0,0,0.12);
    backdrop-filter: blur(6px);
  }

  h1 { font-family:"Titan One",sans-serif; font-size:2.2rem; text-align:center; margin-bottom:18px; text-shadow:2px 2px 4px rgba(0,0,0,0.25); }

  .preview-box{
    height:120px; border-radius:16px; border:2px solid rgba(255,255,255,0.18);
    margin-bottom:22px;
    background:
      linear-gradient(rgba(255,140,0,0.15) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,165,0,0.15) 1px, transparent 1px),
      linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    background-size:40px 40px;
    transition:background .5s ease, box-shadow .5s ease;
  }

  label { display:block; margin:12px 0 8px; font-weight:700; color:rgba(255,255,255,0.95); }

  input[type="text"], input[type="password"]{
    width:100%; padding:12px 14px; border-radius:12px; border:none; font-size:1rem;
    margin-bottom:10px; background:rgba(255,255,255,0.12); color:#000;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.28); transition: all .3s ease;
  }
  input[type="text"]:focus, input[type="password"]:focus { background:rgba(255,255,255,0.18); outline:none; }

  .password-row { display:flex; align-items:center; gap:8px; }
  .toggle-password {
    background: rgba(255,255,255,0.12); color: #fff; border:none; border-radius:10px;
    padding:0 10px; font-size:1.1rem; cursor:pointer; height:44px;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.28); transition: all .25s ease;
  }
  .toggle-password:hover { background: rgba(255,255,255,0.18); }

  .color-card{
    background:rgba(255,255,255,0.06);
    padding:14px; border-radius:12px; margin-bottom:16px;
    border:1px solid rgba(255,255,255,0.06);
  }
  .color-title{ font-weight:800; margin-bottom:10px; color: #fff; }
  .color-display{
    width:100%; height:56px; border-radius:10px;
    border:2px solid rgba(255,255,255,0.12);
    margin-bottom:10px; cursor:pointer;
    transition:transform .25s ease, box-shadow .25s ease;
  }

  .color-picker-panel{
    display:none; flex-direction:column;
    background:rgba(255,255,255,0.98); color:#000;
    padding:12px; border-radius:10px;
  }
  .color-picker-panel.show { display:flex; }

 
  .slider-row { display:flex; align-items:center; gap:12px; margin-bottom:10px; width:100%; }
  .slider-row span.label { width:86px; font-weight:700; color:#111; }
  .slider-row input[type="range"]{ flex:1; width:100%; -webkit-appearance:none; height:10px; background:#e6e6e6; border-radius:6px; }
  .slider-row input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:18px; height:18px; border-radius:50%; background:var(--primary); box-shadow:0 0 6px rgba(0,0,0,0.25); margin-top:-4px; cursor:pointer;}
  .slider-row input[type="range"]::-moz-range-thumb { width:18px; height:18px; border-radius:50%; background:var(--primary); box-shadow:0 0 6px rgba(0,0,0,0.25); cursor:pointer; }
  .slider-value { min-width:56px; text-align:right; font-weight:700; color:#333; }

  .controls-row{ display:flex; gap:12px; align-items:center; margin-bottom:10px; }
  .btn{
    padding:10px 16px; border-radius:10px; border:none; font-weight:800; cursor:pointer;
    background:var(--primary); color:#fff; transition:all .25s ease;
  }
  .btn:hover{ transform:scale(1.03); box-shadow:0 6px 18px rgba(0,0,0,0.18); }
  .btn.danger{ background:#ff4d4d; }


  .theme-row { display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
  .theme-thumbnail-container { position: relative; display:inline-block; }
  .theme-thumbnail { width:64px; height:64px; border-radius:8px; border:2px solid rgba(255,255,255,0.12); cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.22); transition: transform .15s ease; }
  .theme-thumbnail:hover{ transform:scale(1.07); }
  .theme-thumbnail-btns{ position:absolute; top:6px; right:6px; display:flex; gap:6px; opacity:0; transition:opacity .15s ease; }
  .theme-thumbnail-container:hover .theme-thumbnail-btns{ opacity:1; }
  .theme-thumbnail-btns button{ background: rgba(0,0,0,0.55); border:none; color:#fff; border-radius:6px; font-size:0.8rem; width:22px; height:22px; cursor:pointer; }

  #customThemeOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.45); z-index:999; display:none; }
  #customThemeCard {
    position: fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:1000;
    display:none; width:360px; border-radius:12px; overflow:hidden;
    box-shadow:0 18px 48px rgba(0,0,0,0.45);
  }

  #customThemeCard .card-header {
    background:#000; color:#fff; padding:12px 14px; display:flex; align-items:center; justify-content:space-between;
  }
  #customThemeCard .card-header h3 { margin:0; font-size:1.05rem; font-weight:800; letter-spacing:0.4px; }
  #customThemeCard .card-header .close { background:transparent; border:none; color:#fff; font-size:18px; cursor:pointer; }

  #customThemeCard .card-body { background:#fff; padding:14px; color:#111; }
  #customThemeCard input[type="text"]{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid #ddd; font-size:1rem; margin-bottom:10px; }
  #customThemeCard .card-actions { display:flex; gap:10px; justify-content:flex-end; }

  .modal-preview { height:42px; border-radius:8px; border:1px solid #ddd; margin-bottom:10px; box-shadow:inset 0 2px 8px rgba(0,0,0,0.06); }

  .alert-card{
    display:none; position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.85); color:#fff;
    padding:14px 22px; border-radius:14px; box-shadow:0 4px 18px rgba(0,0,0,0.4); font-weight:700; z-index:1500;
  }
  .alert-card.show{ display:block; opacity:1; animation:fadeAlert 0.6s ease forwards; }
  @keyframes fadeAlert{ 0%{opacity:0;} 10%{opacity:1;} 90%{opacity:1;} 100%{opacity:0;} }

  @media (max-width:720px){
    .settings-container{ padding:18px; }
    #customThemeCard{ width:90%; }
    .slider-row { flex-direction:column; align-items:flex-start; }
    .slider-row span.label { width:100%; margin-bottom:6px; }
    .slider-value { width:100%; text-align:left; margin-top:6px; }
  }

  /* Delete overlay + card (single consolidated, animated, themed) */
  #deleteOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0);
    backdrop-filter: blur(0);
    opacity: 0;
    pointer-events: none;
    transition: background 0.28s ease, backdrop-filter 0.28s ease, opacity 0.28s ease;
    z-index: 900;
  }
  #deleteOverlay.active {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    opacity: 1;
    pointer-events: all;
  }

  #deleteCard {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0.92);
    opacity: 0;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(14px);
    color: #fff;
    border: 2px solid rgba(255, 140, 0, 0.35);
    border-radius: 16px;
    width: 360px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.45);
    z-index: 1000;
    padding: 22px;
    text-align: center;
    transition: transform 0.28s cubic-bezier(.2,.9,.3,1), opacity 0.28s ease;
    display: none;
  }
  #deleteCard.show {
    display: block;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  #deleteCard h3 {
    font-size: 1.28rem;
    font-family: 'Titan One', sans-serif;
    color: #ffb347;
    margin-bottom: 10px;
  }
  #deleteCard p {
    font-size: 0.95rem;
    font-family: 'Nunito', sans-serif;
    opacity: 0.95;
    margin-bottom: 18px;
  }
  #deleteCard .actions { display:flex; justify-content:center; gap:12px; }

  /* Buttons styling kept consistent above */
</style>
</head>
<body>
  <div class="header">
    <div class="logo"><div class="logo-text">Scratchlet</div></div>
    <div class="nav-buttons"><a class="nav-btn" href="https://scratchlet-official.github.io/home/">üè† Home</a></div>
  </div>

  <div class="settings-container">
    <h1>‚öôÔ∏è Settings</h1>
    <div class="preview-box" id="previewBox"></div>

    <!-- Username -->
    <label for="username">Change Username</label>
    <div class="controls-row">
      <input id="username" type="text" placeholder="Enter new username">
      <button class="btn" onclick="saveUsername()">Save Username</button>
    </div>

    <!-- Password -->
    <label for="password">Change Password</label>
    <div class="controls-row password-row">
      <input id="password" type="password" placeholder="Enter new password">
      <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
      <button class="btn" onclick="savePassword()">Save Password</button>
    </div>

    <!-- Primary color -->
    <div class="color-card">
      <div class="color-title">Primary Color</div>
      <div id="primaryDisplay" class="color-display" onclick="togglePicker('primary')"></div>
      <div id="primaryPicker" class="color-picker-panel">
        <div class="slider-row"><span class="label">Hue</span><input id="primaryHue" type="range" min="0" max="360" value="30"><div id="primaryHueVal" class="slider-value">30¬∞</div></div>
        <div class="slider-row"><span class="label">Saturation</span><input id="primarySat" type="range" min="0" max="100" value="100"><div id="primarySatVal" class="slider-value">100%</div></div>
        <div class="slider-row"><span class="label">Lightness</span><input id="primaryLight" type="range" min="0" max="100" value="50"><div id="primaryLightVal" class="slider-value">50%</div></div>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" onclick="applyPending('primary')">Apply Primary</button>
          <button class="btn" onclick="preset('primary')">Preset Orange</button>
        </div>
      </div>
    </div>

    <!-- Secondary color -->
    <div class="color-card">
      <div class="color-title">Secondary Color</div>
      <div id="secondaryDisplay" class="color-display" onclick="togglePicker('secondary')"></div>
      <div id="secondaryPicker" class="color-picker-panel">
        <div class="slider-row"><span class="label">Hue</span><input id="secondaryHue" type="range" min="0" max="360" value="45"><div id="secondaryHueVal" class="slider-value">45¬∞</div></div>
        <div class="slider-row"><span class="label">Saturation</span><input id="secondarySat" type="range" min="0" max="100" value="100"><div id="secondarySatVal" class="slider-value">100%</div></div>
        <div class="slider-row"><span class="label">Lightness</span><input id="secondaryLight" type="range" min="0" max="100" value="50"><div id="secondaryLightVal" class="slider-value">50%</div></div>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" onclick="applyPending('secondary')">Apply Secondary</button>
          <button class="btn" onclick="preset('secondary')">Preset Orange</button>
        </div>
      </div>
    </div>

    <!-- Themes row -->
    <div class="color-card">
      <div class="color-title">Preset Color Themes</div>
      <div id="themeCollection" class="theme-row"></div>

      <div style="display:flex; gap:10px; margin-top:12px;">
        <button class="btn" onclick="openAddModal()">‚ûï Add Custom Theme</button>
        <button class="btn" onclick="resetColors()">Reset Colors</button>
        <button class="btn danger" onclick="resetData()">Reset All Data</button>
        <button class="btn danger" onclick="openDeleteModal()">üóëÔ∏è Delete Account</button>
      </div>
    </div>
  </div>

  <!-- Delete overlay & modal (moved outside container so overlay covers whole page) -->
  <div id="deleteOverlay" onclick="closeDeleteModal()"></div>
  <div id="deleteCard" role="dialog" aria-modal="true">
    <h3>‚ö†Ô∏è Delete Account?</h3>
    <p>Are you sure you want to delete your account? This action will permanently erase all stored data and cannot be undone.</p>
    <div class="actions">
      <button class="btn danger glow" onclick="confirmDelete()">Yes, Delete</button>
      <button class="btn" onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>

  <!-- custom theme modal -->
  <div id="customThemeOverlay" onclick="closeCustomThemeCard()"></div>
  <div id="customThemeCard" role="dialog" aria-modal="true" aria-labelledby="customThemeTitle">
    <div class="card-header">
      <h3 id="customThemeTitle">Custom Theme</h3>
      <button class="close" onclick="closeCustomThemeCard()">‚úï</button>
    </div>
    <div class="card-body">
      <div class="modal-preview" id="modalPreview"></div>
      <input id="customThemeName" type="text" placeholder="Enter theme name">
      <input type="hidden" id="customThemeIndex">
      <div class="card-actions">
        <button class="btn" onclick="saveCustomThemeFromCard()">Save</button>
        <button class="btn danger" onclick="closeCustomThemeCard()">Cancel</button>
      </div>
    </div>
  </div>

  <div id="alertCard" class="alert-card"></div>

<script>
/* ---------- Utilities ---------- */
function hslString(h,s,l){ return `hsl(${h},${s}%,${l}%)`; }
function hslToRgb(h, s, l) {
  // h in degrees, s/l in 0..1
  let a = s * Math.min(l, 1 - l);
  const f = n => {
    const k = (n + h / 30) % 12;
    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
    return Math.round(255 * color);
  };
  return [f(0), f(8), f(4)];
}

/* ---------- State ---------- */
const defaultThemes = [
  { name: 'Default', primary:{h:30,s:100,l:50}, secondary:{h:45,s:100,l:50} },
  { name: 'Jolly', primary:{h:12,s:88,l:57}, secondary:{h:210,s:78,l:48} },
  { name: 'Mint', primary:{h:160,s:70,l:62}, secondary:{h:200,s:50,l:70} },
  { name: 'Purple', primary:{h:270,s:68,l:60}, secondary:{h:270,s:68,l:50} },
  { name: 'Snowy', primary:{h:200,s:100,l:100}, secondary:{h:200,s:95,l:90} },
  { name: 'Midnight', primary:{h:250,s:60,l:10}, secondary:{h:285,s:65,l:35} },
  { name: 'Blooket', primary:{h:200,s:95,l:50}, secondary:{h:200,s:95,l:58} },
  { name: 'Blacket', primary:{h:0,s:0,l:8}, secondary:{h:0,s:0,l:0} },
];

let customThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');

let applied = JSON.parse(localStorage.getItem('appliedColors') || JSON.stringify({
  primary: { h:30,s:100,l:50 },
  secondary: { h:45,s:100,l:50 }
}));

let pending = { primary: {...applied.primary}, secondary: {...applied.secondary} };

function getAllThemes(){ return [...defaultThemes, ...customThemes]; }

/* ---------- DOM helpers ---------- */
function showAlert(msg){
  const alert = document.getElementById('alertCard');
  if(!alert) return;
  alert.textContent = msg;
  alert.classList.add('show');
  setTimeout(()=>alert.classList.remove('show'), 2000);
}

/* ---------- Color display & gradient ---------- */
function updateDisplay(color){
  const h = +document.getElementById(color+'Hue').value;
  const s = +document.getElementById(color+'Sat').value;
  const l = +document.getElementById(color+'Light').value;

  document.getElementById(color+'HueVal').textContent = h+'¬∞';
  document.getElementById(color+'SatVal').textContent = s+'%';
  document.getElementById(color+'LightVal').textContent = l+'%';

  const disp = document.getElementById(color+'Display');
  if(disp) disp.style.background = hslString(h,s,l);
  pending[color] = { h,s,l };

  updateModalPreview();
}

function applyPending(color){
  applied[color] = {...pending[color]};
  localStorage.setItem('appliedColors', JSON.stringify(applied));
  updateGradient();
  showAlert(color.charAt(0).toUpperCase()+color.slice(1)+' color applied!');
}

function updateGradient(){
  const p = applied.primary, s = applied.secondary;
  const gridPrimary = `rgba(${hslToRgb(p.h,p.s/100,p.l/100).join(',')},0.12)`;
  const gridSecondary = `rgba(${hslToRgb(s.h,s.s/100,s.l/100).join(',')},0.12)`;
  const bg = `linear-gradient(${gridPrimary} 1px, transparent 1px),
              linear-gradient(90deg, ${gridSecondary} 1px, transparent 1px),
              linear-gradient(135deg, ${hslString(p.h,p.s,p.l)} 0%, ${hslString(s.h,s.s,s.l)} 100%)`;
  document.body.style.background = bg;
  document.body.style.backgroundSize = "40px 40px";
  const preview = document.getElementById('previewBox');
  if(preview){
    preview.style.background = bg;
    preview.style.backgroundSize = "40px 40px";
  }
}

/* ---------- presets ---------- */
function preset(color){
  if(color === 'primary'){ pending[color] = {h:30,s:100,l:50}; }
  else { pending[color] = {h:45,s:100,l:50}; }
  document.getElementById(color+'Hue').value = pending[color].h;
  document.getElementById(color+'Sat').value = pending[color].s;
  document.getElementById(color+'Light').value = pending[color].l;
  updateDisplay(color);
}

/* ---------- toggle picker UI ---------- */
function togglePicker(color){
  const panel = document.getElementById(color+'Picker');
  const open = panel.classList.contains('show');
  document.querySelectorAll('.color-picker-panel').forEach(p=>p.classList.remove('show'));
  if(!open) panel.classList.add('show');
}

/* ---------- Username / Password ---------- */
function saveUsername(){
  const name = document.getElementById('username').value.trim();
  if(name.length < 3){ showAlert('Username too short'); return; }
  if(name.includes(' ')){ showAlert('Username cannot have spaces'); return; }
  const offensive = ['badword1','badword2']; // example list
  if(offensive.some(w=>name.toLowerCase().includes(w))){ showAlert('Username is offensive'); return; }
  const data = JSON.parse(localStorage.getItem('userData') || '{}');
  data.username = name;
  localStorage.setItem('userData', JSON.stringify(data));
  showAlert('Username saved!');
}
function savePassword(){
  const pw = document.getElementById('password').value.trim();
  if(pw.length < 6){ showAlert('Password too short'); return; }
  if(pw.includes(' ')){ showAlert('Password cannot have spaces'); return; }
  const offensive = ['badword1','badword2'];
  if(offensive.some(w=>pw.toLowerCase().includes(w))){ showAlert('Password is offensive'); return; }
  const data = JSON.parse(localStorage.getItem('userData') || '{}');
  data.password = pw;
  localStorage.setItem('userData', JSON.stringify(data));
  showAlert('Password saved!');
}
function togglePassword(){
  const pw = document.getElementById('password');
  const btn = document.querySelector('.toggle-password');
  if(pw.type === 'password'){ pw.type = 'text'; if(btn) btn.textContent = 'üôà'; }
  else { pw.type = 'password'; if(btn) btn.textContent = 'üëÅÔ∏è'; }
}

/* ---------- reset ---------- */
function resetColors(){
  pending.primary = {h:30,s:100,l:50};
  pending.secondary = {h:45,s:100,l:50};
  applyPending('primary'); applyPending('secondary');
  showAlert('Colors reset!');
}
function resetData(){
  if(!confirm('Clear all stored data (themes, settings)?')) return;
  localStorage.clear();
  showAlert('All data reset ‚Äî reloading...');
  setTimeout(()=>location.reload(), 800);
}

/* ---------- Themes UI ---------- */
function renderThemes(){
  const container = document.getElementById('themeCollection');
  if(!container) return;
  container.innerHTML = '';
  const all = getAllThemes();
  all.forEach((t,i)=>{
    const wrapper = document.createElement('div');
    wrapper.className = 'theme-thumbnail-container';

    const thumb = document.createElement('div');
    thumb.className = 'theme-thumbnail';
    thumb.title = t.name;
    thumb.style.background = `linear-gradient(135deg, ${hslString(t.primary.h,t.primary.s,t.primary.l)} 0%, ${hslString(t.secondary.h,t.secondary.s,t.secondary.l)} 100%)`;
    thumb.onclick = ()=>applyTheme(i);

    const btns = document.createElement('div');
    btns.className = 'theme-thumbnail-btns';

    if(i >= defaultThemes.length){
      const editBtn = document.createElement('button');
      editBtn.textContent = '‚öôÔ∏è';
      editBtn.title = 'Edit theme';
      editBtn.onclick = (e)=>{ e.stopPropagation(); openEditModal(i); };
      btns.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.textContent = '‚ùåÔ∏è';
      delBtn.title = 'Delete theme';
      delBtn.onclick = (e)=>{ e.stopPropagation(); deleteCustomTheme(i); };
      btns.appendChild(delBtn);
    } else {
      const infoBtn = document.createElement('button');
      infoBtn.textContent = '‚≠ê';
      infoBtn.title = t.name + ' (preset)';
      infoBtn.onclick = (e)=>{ e.stopPropagation(); applyTheme(i); };
      btns.appendChild(infoBtn);
    }

    wrapper.appendChild(thumb);
    wrapper.appendChild(btns);
    container.appendChild(wrapper);
  });
}

function applyTheme(index){
  const all = getAllThemes();
  const t = all[index];
  applied.primary = {...t.primary};
  applied.secondary = {...t.secondary};
  localStorage.setItem('appliedColors', JSON.stringify(applied));
  ['primary','secondary'].forEach(c=>{
    pending[c] = {...applied[c]};
    const elHue = document.getElementById(c+'Hue');
    const elSat = document.getElementById(c+'Sat');
    const elLight = document.getElementById(c+'Light');
    if(elHue) elHue.value = pending[c].h;
    if(elSat) elSat.value = pending[c].s;
    if(elLight) elLight.value = pending[c].l;
    updateDisplay(c);
  });
  updateGradient();
  showAlert(t.name + ' theme applied!');
}

function openAddModal(){
  document.getElementById('customThemeOverlay').style.display = 'block';
  document.getElementById('customThemeCard').style.display = 'block';
  document.getElementById('customThemeName').value = '';
  document.getElementById('customThemeIndex').value = '';
  updateModalPreview();
}
function openEditModal(globalIndex){
  const all = getAllThemes();
  const t = all[globalIndex];
  ['primary','secondary'].forEach(c=>{
    pending[c] = {...t[c]};
    const elHue = document.getElementById(c+'Hue');
    const elSat = document.getElementById(c+'Sat');
    const elLight = document.getElementById(c+'Light');
    if(elHue) elHue.value = pending[c].h;
    if(elSat) elSat.value = pending[c].s;
    if(elLight) elLight.value = pending[c].l;
    updateDisplay(c);
  });
  document.getElementById('customThemeOverlay').style.display = 'block';
  document.getElementById('customThemeCard').style.display = 'block';
  document.getElementById('customThemeName').value = t.name || '';
  document.getElementById('customThemeIndex').value = globalIndex;
  updateModalPreview();
}
function closeCustomThemeCard(){
  document.getElementById('customThemeOverlay').style.display = 'none';
  document.getElementById('customThemeCard').style.display = 'none';
  document.getElementById('customThemeIndex').value = '';
}
function saveCustomThemeFromCard(){
  const name = document.getElementById('customThemeName').value.trim();
  if(!name){ showAlert('Theme name cannot be empty'); return; }
  const idx = document.getElementById('customThemeIndex').value;
  const themeObj = { name, primary: {...pending.primary}, secondary: {...pending.secondary} };
  if(idx === '' || idx === null){
    customThemes.push(themeObj);
    localStorage.setItem('customThemes', JSON.stringify(customThemes));
    showAlert('Custom theme added!');
  } else {
    const g = Number(idx);
    const customIndex = g - defaultThemes.length;
    if(customIndex >= 0 && customIndex < customThemes.length){
      customThemes[customIndex] = themeObj;
      localStorage.setItem('customThemes', JSON.stringify(customThemes));
      showAlert('Custom theme updated!');
    } else {
      customThemes.push(themeObj);
      localStorage.setItem('customThemes', JSON.stringify(customThemes));
      showAlert('Custom theme added!');
    }
  }
  closeCustomThemeCard();
  renderThemes();
}
function deleteCustomTheme(globalIndex){
  if(!confirm('Delete this custom theme?')) return;
  const customIndex = globalIndex - defaultThemes.length;
  if(customIndex >=0 && customIndex < customThemes.length){
    customThemes.splice(customIndex,1);
    localStorage.setItem('customThemes', JSON.stringify(customThemes));
    renderThemes();
    showAlert('Custom theme deleted');
  }
}
function updateModalPreview(){
  const box = document.getElementById('modalPreview');
  if(!box) return;
  const pendingPrimary = pending.primary, pendingSecondary = pending.secondary;
  const pendingHSLLeft = hslString(pendingPrimary.h,pendingPrimary.s,pendingPrimary.l);
  const pendingHSLRight = hslString(pendingSecondary.h,pendingSecondary.s,pendingSecondary.l);
  box.style.background = `linear-gradient(90deg, ${pendingHSLLeft} 0%, ${pendingHSLRight} 100%)`;
}

/* ---------- Init ---------- */
function init(){
  ['primary','secondary'].forEach(c=>{
    ['Hue','Sat','Light'].forEach(s=>{
      const el = document.getElementById(c+s);
      if(el) el.addEventListener('input', ()=> updateDisplay(c));
    });
  });

  ['primary','secondary'].forEach(c=>{
    const a = applied[c];
    pending[c] = {...a};
    const hue = document.getElementById(c+'Hue');
    const sat = document.getElementById(c+'Sat');
    const light = document.getElementById(c+'Light');
    if(hue) hue.value = a.h;
    if(sat) sat.value = a.s;
    if(light) light.value = a.l;
    updateDisplay(c);
    const disp = document.getElementById(c+'Display');
    if(disp) disp.style.background = hslString(a.h,a.s,a.l);
  });

  updateGradient();
  renderThemes();
}
init();

/* Expose for debug */
window._scratchlet = {
  getApplied: ()=>applied,
  getCustomThemes: ()=>customThemes
};

/* ---------- Delete modal handlers ---------- */
function openDeleteModal() {
  const overlay = document.getElementById('deleteOverlay');
  const card = document.getElementById('deleteCard');
  overlay.classList.add('active');
  card.style.display = 'block';
  setTimeout(()=>card.classList.add('show'), 12);
}

function closeDeleteModal() {
  const overlay = document.getElementById('deleteOverlay');
  const card = document.getElementById('deleteCard');
  card.classList.remove('show');
  overlay.classList.remove('active');
  setTimeout(()=> { card.style.display = 'none'; }, 260);
}

function confirmDelete() {
  localStorage.clear();
  closeDeleteModal();
  showAlert('üíÄ Account deleted.');
  setTimeout(()=>{ window.location.href = 'https://scratchlet-official.github.io/scratchlet/'; }, 900);
}
</script>
</body>
</html>
